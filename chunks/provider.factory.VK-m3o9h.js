var Ee=Object.defineProperty;var Se=(s,r,e)=>r in s?Ee(s,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[r]=e;var C=(s,r,e)=>Se(s,typeof r!="symbol"?r+"":r,e);import{L as K,c as ae}from"./tools.D9zwH9nK.js";function pe(s){var r,e,t="";if(typeof s=="string"||typeof s=="number")t+=s;else if(typeof s=="object")if(Array.isArray(s)){var n=s.length;for(r=0;r<n;r++)s[r]&&(e=pe(s[r]))&&(t&&(t+=" "),t+=e)}else for(e in s)s[e]&&(t&&(t+=" "),t+=e);return t}function ke(){for(var s,r,e=0,t="",n=arguments.length;e<n;e++)(s=arguments[e])&&(r=pe(s))&&(t&&(t+=" "),t+=r);return t}const V="-",Ae=s=>{const r=$e(s),{conflictingClassGroups:e,conflictingClassGroupModifiers:t}=s;return{getClassGroupId:a=>{const i=a.split(V);return i[0]===""&&i.length!==1&&i.shift(),me(i,r)||Te(a)},getConflictingClassGroupIds:(a,i)=>{const c=e[a]||[];return i&&t[a]?[...c,...t[a]]:c}}},me=(s,r)=>{var a;if(s.length===0)return r.classGroupId;const e=s[0],t=r.nextPart.get(e),n=t?me(s.slice(1),t):void 0;if(n)return n;if(r.validators.length===0)return;const o=s.join(V);return(a=r.validators.find(({validator:i})=>i(o)))==null?void 0:a.classGroupId},ie=/^\[(.+)\]$/,Te=s=>{if(ie.test(s)){const r=ie.exec(s)[1],e=r==null?void 0:r.substring(0,r.indexOf(":"));if(e)return"arbitrary.."+e}},$e=s=>{const{theme:r,prefix:e}=s,t={nextPart:new Map,validators:[]};return Me(Object.entries(s.classGroups),e).forEach(([o,a])=>{W(a,t,o,r)}),t},W=(s,r,e,t)=>{s.forEach(n=>{if(typeof n=="string"){const o=n===""?r:le(r,n);o.classGroupId=e;return}if(typeof n=="function"){if(Ie(n)){W(n(t),r,e,t);return}r.validators.push({validator:n,classGroupId:e});return}Object.entries(n).forEach(([o,a])=>{W(a,le(r,o),e,t)})})},le=(s,r)=>{let e=s;return r.split(V).forEach(t=>{e.nextPart.has(t)||e.nextPart.set(t,{nextPart:new Map,validators:[]}),e=e.nextPart.get(t)}),e},Ie=s=>s.isThemeGetter,Me=(s,r)=>r?s.map(([e,t])=>{const n=t.map(o=>typeof o=="string"?r+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([a,i])=>[r+a,i])):o);return[e,n]}):s,Pe=s=>{if(s<1)return{get:()=>{},set:()=>{}};let r=0,e=new Map,t=new Map;const n=(o,a)=>{e.set(o,a),r++,r>s&&(r=0,t=e,e=new Map)};return{get(o){let a=e.get(o);if(a!==void 0)return a;if((a=t.get(o))!==void 0)return n(o,a),a},set(o,a){e.has(o)?e.set(o,a):n(o,a)}}},fe="!",Oe=s=>{const{separator:r,experimentalParseClassName:e}=s,t=r.length===1,n=r[0],o=r.length,a=i=>{const c=[];let l=0,d=0,u;for(let g=0;g<i.length;g++){let y=i[g];if(l===0){if(y===n&&(t||i.slice(g,g+o)===r)){c.push(i.slice(d,g)),d=g+o;continue}if(y==="/"){u=g;continue}}y==="["?l++:y==="]"&&l--}const f=c.length===0?i:i.substring(d),v=f.startsWith(fe),h=v?f.substring(1):f,m=u&&u>d?u-d:void 0;return{modifiers:c,hasImportantModifier:v,baseClassName:h,maybePostfixModifierPosition:m}};return e?i=>e({className:i,parseClassName:a}):a},Re=s=>{if(s.length<=1)return s;const r=[];let e=[];return s.forEach(t=>{t[0]==="["?(r.push(...e.sort(),t),e=[]):e.push(t)}),r.push(...e.sort()),r},ze=s=>({cache:Pe(s.cacheSize),parseClassName:Oe(s),...Ae(s)}),Le=/\s+/,Ue=(s,r)=>{const{parseClassName:e,getClassGroupId:t,getConflictingClassGroupIds:n}=r,o=[],a=s.trim().split(Le);let i="";for(let c=a.length-1;c>=0;c-=1){const l=a[c],{modifiers:d,hasImportantModifier:u,baseClassName:f,maybePostfixModifierPosition:v}=e(l);let h=!!v,m=t(h?f.substring(0,v):f);if(!m){if(!h){i=l+(i.length>0?" "+i:i);continue}if(m=t(f),!m){i=l+(i.length>0?" "+i:i);continue}h=!1}const g=Re(d).join(":"),y=u?g+fe:g,x=y+m;if(o.includes(x))continue;o.push(x);const S=n(m,h);for(let k=0;k<S.length;++k){const _=S[k];o.push(y+_)}i=l+(i.length>0?" "+i:i)}return i};function Ne(){let s=0,r,e,t="";for(;s<arguments.length;)(r=arguments[s++])&&(e=ye(r))&&(t&&(t+=" "),t+=e);return t}const ye=s=>{if(typeof s=="string")return s;let r,e="";for(let t=0;t<s.length;t++)s[t]&&(r=ye(s[t]))&&(e&&(e+=" "),e+=r);return e};function _e(s,...r){let e,t,n,o=a;function a(c){const l=r.reduce((d,u)=>u(d),s());return e=ze(l),t=e.cache.get,n=e.cache.set,o=i,i(c)}function i(c){const l=t(c);if(l)return l;const d=Ue(c,e);return n(c,d),d}return function(){return o(Ne.apply(null,arguments))}}const b=s=>{const r=e=>e[s]||[];return r.isThemeGetter=!0,r},be=/^\[(?:([a-z-]+):)?(.+)\]$/i,De=/^\d+\/\d+$/,Ge=new Set(["px","full","screen"]),Be=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,qe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,je=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,He=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Fe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,T=s=>R(s)||Ge.has(s)||De.test(s),$=s=>z(s,"length",Qe),R=s=>!!s&&!Number.isNaN(Number(s)),J=s=>z(s,"number",R),U=s=>!!s&&Number.isInteger(Number(s)),Je=s=>s.endsWith("%")&&R(s.slice(0,-1)),p=s=>be.test(s),I=s=>Be.test(s),We=new Set(["length","size","percentage"]),Ke=s=>z(s,We,we),Ve=s=>z(s,"position",we),Ye=new Set(["image","url"]),Ze=s=>z(s,Ye,tt),Xe=s=>z(s,"",et),N=()=>!0,z=(s,r,e)=>{const t=be.exec(s);return t?t[1]?typeof r=="string"?t[1]===r:r.has(t[1]):e(t[2]):!1},Qe=s=>qe.test(s)&&!je.test(s),we=()=>!1,et=s=>He.test(s),tt=s=>Fe.test(s),rt=()=>{const s=b("colors"),r=b("spacing"),e=b("blur"),t=b("brightness"),n=b("borderColor"),o=b("borderRadius"),a=b("borderSpacing"),i=b("borderWidth"),c=b("contrast"),l=b("grayscale"),d=b("hueRotate"),u=b("invert"),f=b("gap"),v=b("gradientColorStops"),h=b("gradientColorStopPositions"),m=b("inset"),g=b("margin"),y=b("opacity"),x=b("padding"),S=b("saturate"),k=b("scale"),_=b("sepia"),Q=b("skew"),ee=b("space"),te=b("translate"),q=()=>["auto","contain","none"],j=()=>["auto","hidden","clip","visible","scroll"],H=()=>["auto",p,r],w=()=>[p,r],re=()=>["",T,$],D=()=>["auto",R,p],se=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],G=()=>["solid","dashed","dotted","double","none"],ne=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],L=()=>["","0",p],oe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>[R,p];return{cacheSize:500,separator:":",theme:{colors:[N],spacing:[T,$],blur:["none","",I,p],brightness:A(),borderColor:[s],borderRadius:["none","","full",I,p],borderSpacing:w(),borderWidth:re(),contrast:A(),grayscale:L(),hueRotate:A(),invert:L(),gap:w(),gradientColorStops:[s],gradientColorStopPositions:[Je,$],inset:H(),margin:H(),opacity:A(),padding:w(),saturate:A(),scale:A(),sepia:L(),skew:A(),space:w(),translate:w()},classGroups:{aspect:[{aspect:["auto","square","video",p]}],container:["container"],columns:[{columns:[I]}],"break-after":[{"break-after":oe()}],"break-before":[{"break-before":oe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...se(),p]}],overflow:[{overflow:j()}],"overflow-x":[{"overflow-x":j()}],"overflow-y":[{"overflow-y":j()}],overscroll:[{overscroll:q()}],"overscroll-x":[{"overscroll-x":q()}],"overscroll-y":[{"overscroll-y":q()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",U,p]}],basis:[{basis:H()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",p]}],grow:[{grow:L()}],shrink:[{shrink:L()}],order:[{order:["first","last","none",U,p]}],"grid-cols":[{"grid-cols":[N]}],"col-start-end":[{col:["auto",{span:["full",U,p]},p]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[N]}],"row-start-end":[{row:["auto",{span:[U,p]},p]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",p]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",p]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[x]}],px:[{px:[x]}],py:[{py:[x]}],ps:[{ps:[x]}],pe:[{pe:[x]}],pt:[{pt:[x]}],pr:[{pr:[x]}],pb:[{pb:[x]}],pl:[{pl:[x]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[ee]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ee]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",p,r]}],"min-w":[{"min-w":[p,r,"min","max","fit"]}],"max-w":[{"max-w":[p,r,"none","full","min","max","fit","prose",{screen:[I]},I]}],h:[{h:[p,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[p,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[p,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[p,r,"auto","min","max","fit"]}],"font-size":[{text:["base",I,$]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",J]}],"font-family":[{font:[N]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",p]}],"line-clamp":[{"line-clamp":["none",R,J]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",T,p]}],"list-image":[{"list-image":["none",p]}],"list-style-type":[{list:["none","disc","decimal",p]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[s]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[s]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",T,$]}],"underline-offset":[{"underline-offset":["auto",T,p]}],"text-decoration-color":[{decoration:[s]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:w()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",p]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",p]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...se(),Ve]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Ke]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Ze]}],"bg-color":[{bg:[s]}],"gradient-from-pos":[{from:[h]}],"gradient-via-pos":[{via:[h]}],"gradient-to-pos":[{to:[h]}],"gradient-from":[{from:[v]}],"gradient-via":[{via:[v]}],"gradient-to":[{to:[v]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...G(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:G()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...G()]}],"outline-offset":[{"outline-offset":[T,p]}],"outline-w":[{outline:[T,$]}],"outline-color":[{outline:[s]}],"ring-w":[{ring:re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[s]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[T,$]}],"ring-offset-color":[{"ring-offset":[s]}],shadow:[{shadow:["","inner","none",I,Xe]}],"shadow-color":[{shadow:[N]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...ne(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ne()}],filter:[{filter:["","none"]}],blur:[{blur:[e]}],brightness:[{brightness:[t]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",I,p]}],grayscale:[{grayscale:[l]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[S]}],sepia:[{sepia:[_]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[e]}],"backdrop-brightness":[{"backdrop-brightness":[t]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[l]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[_]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",p]}],duration:[{duration:A()}],ease:[{ease:["linear","in","out","in-out",p]}],delay:[{delay:A()}],animate:[{animate:["none","spin","ping","pulse","bounce",p]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[U,p]}],"translate-x":[{"translate-x":[te]}],"translate-y":[{"translate-y":[te]}],"skew-x":[{"skew-x":[Q]}],"skew-y":[{"skew-y":[Q]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",p]}],accent:[{accent:["auto",s]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",p]}],"caret-color":[{caret:[s]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":w()}],"scroll-mx":[{"scroll-mx":w()}],"scroll-my":[{"scroll-my":w()}],"scroll-ms":[{"scroll-ms":w()}],"scroll-me":[{"scroll-me":w()}],"scroll-mt":[{"scroll-mt":w()}],"scroll-mr":[{"scroll-mr":w()}],"scroll-mb":[{"scroll-mb":w()}],"scroll-ml":[{"scroll-ml":w()}],"scroll-p":[{"scroll-p":w()}],"scroll-px":[{"scroll-px":w()}],"scroll-py":[{"scroll-py":w()}],"scroll-ps":[{"scroll-ps":w()}],"scroll-pe":[{"scroll-pe":w()}],"scroll-pt":[{"scroll-pt":w()}],"scroll-pr":[{"scroll-pr":w()}],"scroll-pb":[{"scroll-pb":w()}],"scroll-pl":[{"scroll-pl":w()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",p]}],fill:[{fill:[s,"none"]}],"stroke-w":[{stroke:[T,$,J]}],stroke:[{stroke:[s,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},st=_e(rt);function mt(...s){return st(ke(s))}function nt(s){return new Promise(r=>setTimeout(r,s))}function ft(s,r){const e=r??s*.4,t=s+Math.random()*e;return nt(t)}var E=(s=>(s.GEMINI="gemini",s.OPENAI="openai",s.OLLAMA="ollama",s.OLLAMA_CLOUD="ollama_cloud",s))(E||{});const ot="Your_API_Key_here",at="",it="21m00Tcm4TlvDq8ikWAM";var lt=(s=>(s[s.GUIDANCE_ONLY=1]="GUIDANCE_ONLY",s[s.ASSISTED_INPUT=2]="ASSISTED_INPUT",s))(lt||{});const ce={provider:E.GEMINI,apiKey:ot,model:"gemini-3-flash-preview",baseUrl:"",confirmTools:!1,permissionLevel:1,searchUrl:"https://www.google.com/search?q=",voiceEnabled:!0,autoReadGuidance:!0,voiceRate:1,voicePitch:1,voiceVolume:1,theme:"dark",colorScheme:"orange",fontSize:"medium",showDebugLog:!1,behaviorDetectionEnabled:!0,proactiveGuidance:!0,strictBrowserAgentMode:!1,preferredRetailer:"any",enableScreenshotTool:!0,activationKey:"AltLeft",elevenLabsApiKey:at,elevenLabsVoiceId:it,hasCompletedFirstRun:!1,useDemoKey:!1,fiveClickHelpEnabled:!1},yt={[E.GEMINI]:{baseUrl:"",model:"gemini-3-flash-preview"},[E.OPENAI]:{baseUrl:"https://api.openai.com/v1",model:"gpt-4o-mini"},[E.OLLAMA]:{baseUrl:"http://localhost:11434/v1",model:"llama3.1"},[E.OLLAMA_CLOUD]:{baseUrl:"",model:"llama3.1"}};class Y{constructor(r){C(this,"logger");C(this,"initialized",!1);C(this,"initPromise",null);this.serviceName=r,this.logger=new K(r)}async ensureInitialized(){this.initialized||(this.initPromise||(this.initPromise=this.performInitialization()),await this.initPromise)}async performInitialization(){try{this.logger.debug("Initializing service..."),await this.initialize(),this.initialized=!0,this.logger.info("Service initialized successfully")}catch(r){throw this.logger.error("Failed to initialize service",r),r}}isInitialized(){return this.initialized}handleError(r,e){const t=new Z(this.serviceName,e,r instanceof Error?r.message:String(r),r instanceof Error?r:void 0);throw this.logger.error(`${e}: ${t.message}`),t}async withErrorHandling(r,e){try{return await r()}catch(t){this.handleError(t,e)}}async dispose(){this.logger.debug("Disposing service..."),this.initialized=!1,this.initPromise=null}}class Z extends Error{constructor(r,e,t,n){super(`[${r}] ${e}: ${t}`),this.service=r,this.context=e,this.cause=n,this.name="ServiceError",Error.captureStackTrace&&Error.captureStackTrace(this,Z)}toJSON(){var r;return{name:this.name,message:this.message,service:this.service,context:this.context,cause:(r=this.cause)==null?void 0:r.message}}}const M=class M extends Y{constructor(){super("StorageService");C(this,"changeListeners",new Map)}static getInstance(){return M.instance||(M.instance=new M),M.instance}async initialize(){chrome.storage.onChanged.addListener((e,t)=>{this.handleStorageChange(e,t)}),this.logger.debug("Storage change listener registered")}handleStorageChange(e,t){if(t==="local")for(const[n,o]of Object.entries(e)){const a=this.changeListeners.get(n);if(a)for(const i of a)try{i(o.newValue,o.oldValue)}catch(c){this.logger.error(`Storage change callback error for ${n}`,c)}}}async get(e,t="local"){return await this.ensureInitialized(),this.withErrorHandling(async()=>{const o=(await chrome.storage[t].get(e))[e];return this.logger.debug(`Get ${e}`,o?"found":"not found"),o??null},`get(${e})`)}async set(e,t,n="local"){return await this.ensureInitialized(),this.withErrorHandling(async()=>{await chrome.storage[n].set({[e]:t}),this.logger.debug(`Set ${e}`,t)},`set(${e})`)}async remove(e,t="local"){return await this.ensureInitialized(),this.withErrorHandling(async()=>{await chrome.storage[t].remove(e),this.logger.debug(`Removed ${e}`)},`remove(${e})`)}async clear(e="local"){return await this.ensureInitialized(),this.withErrorHandling(async()=>{await chrome.storage[e].clear(),this.logger.info(`Cleared ${e} storage`)},"clear")}subscribe(e,t){let n=this.changeListeners.get(e);return n||(n=new Set,this.changeListeners.set(e,n)),n.add(t),this.logger.debug(`Subscribed to ${e} changes`),()=>{n==null||n.delete(t),this.logger.debug(`Unsubscribed from ${e} changes`)}}async getAll(e="local"){return await this.ensureInitialized(),this.withErrorHandling(async()=>await chrome.storage[e].get(null),"getAll")}async getBytesInUse(e="local"){return await this.ensureInitialized(),this.withErrorHandling(async()=>await chrome.storage[e].getBytesInUse(null),"getBytesInUse")}async getSettings(){try{return await this.get("settings")??ce}catch(e){return this.logger.error("getSettings failed, returning DEFAULT_SETTINGS",e),ce}}async updateSettings(e){const t=await this.getSettings();await this.set("settings",{...t,...e})}async getStats(){return await this.get("behaviorStats")??{guidanceCount:0,difficultiesDetected:0,voiceAnnouncements:0,totalInteractions:0,sessionDuration:0}}async incrementStat(e){const t=await this.getStats();t[e]++,await this.set("behaviorStats",t)}async getLastSession(){return this.get("lastSession")}async updateSession(e){const t=await this.getLastSession();await this.set("lastSession",{startTime:Date.now(),completedSteps:[],...t,...e})}async addDiagnostic(e){const t=await this.get("diagnostics")??[];t.unshift(e),await this.set("diagnostics",t.slice(0,50))}async getPersonalData(){return await this.get("personalData")??{}}async updatePersonalData(e){const t=await this.getPersonalData();await this.set("personalData",{...t,...e})}async clearPersonalData(){await this.remove("personalData")}};C(M,"instance",null);let de=M;const P=class P extends Y{constructor(){super("MessagingService");C(this,"handlers",new Map);C(this,"pendingRequests",new Map)}static getInstance(){return P.instance||(P.instance=new P),P.instance}async initialize(){chrome.runtime.onMessage.addListener((e,t,n)=>(this.handleIncomingMessage(e,t).then(n).catch(o=>{this.logger.error("Message handler error",o),n({success:!1,error:String(o)})}),!0)),this.logger.debug("Message listener registered")}async handleIncomingMessage(e,t){var o;if(!e||typeof e.type!="string")return this.logger.warn("Invalid message received",e),{success:!1,error:"Invalid message format"};const n=this.handlers.get(e.type);if(!n)return this.logger.warn(`No handler for message type: ${e.type}`),{success:!1,error:`Unknown message type: ${e.type}`};try{return this.logger.debug(`Handling message: ${e.type}`,{payload:e.payload,sender:(o=t.tab)==null?void 0:o.id}),await n(e.payload,t)}catch(a){return this.logger.error(`Handler error for ${e.type}`,a),{success:!1,error:a instanceof Error?a.message:String(a)}}}registerHandler(e,t){this.handlers.has(e)&&this.logger.warn(`Overwriting existing handler for: ${e}`),this.handlers.set(e,t),this.logger.debug(`Registered handler for: ${e}`)}unregisterHandler(e){this.handlers.delete(e),this.logger.debug(`Unregistered handler for: ${e}`)}async send(e,t){return await this.ensureInitialized(),this.withErrorHandling(async()=>{const n=ae(e,t);return this.logger.debug(`Sending message: ${e}`,t),await chrome.runtime.sendMessage(n)},`send(${e})`)}async sendToTab(e,t,n){return await this.ensureInitialized(),this.withErrorHandling(async()=>{var a,i,c,l,d;const o=ae(t,n,e);this.logger.debug(`Sending to tab ${e}: ${t}`,n);try{const u=await chrome.tabs.get(e).catch(()=>null);return u?(a=u.url)!=null&&a.startsWith("chrome://")||(i=u.url)!=null&&i.startsWith("chrome-extension://")||(c=u.url)!=null&&c.startsWith("edge://")||(l=u.url)!=null&&l.startsWith("about:")?{success:!1,error:`Cannot inject content script into ${(d=u.url)==null?void 0:d.split("://")[0]}:// pages`}:await chrome.tabs.sendMessage(e,o):{success:!1,error:`Tab ${e} does not exist or is not accessible`}}catch(u){const f=u instanceof Error?u.message:String(u);if(f.includes("Receiving end does not exist"))return{success:!1,error:"Content script not loaded. Please refresh the page and try again."};if(f.includes("Cannot access"))return{success:!1,error:"Cannot access this page. The extension may not have permission."};throw u}},`sendToTab(${e}, ${t})`)}async sendToActiveTab(e,t){const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});return n!=null&&n.id?this.sendToTab(n.id,e,t):{success:!1,error:"No active tab found"}}async broadcast(e,t){await this.ensureInitialized();const n=await chrome.tabs.query({}),o=new Map;return await Promise.allSettled(n.map(async a=>{if(a.id)try{const i=await this.sendToTab(a.id,e,t);o.set(a.id,i)}catch(i){o.set(a.id,{success:!1,error:i instanceof Error?i.message:String(i)})}})),this.logger.debug(`Broadcast ${e} to ${o.size} tabs`),o}async sendAndWait(e,t,n,o=3e4){return new Promise((a,i)=>{const c=crypto.randomUUID(),l=setTimeout(()=>{this.pendingRequests.delete(c),i(new Error(`Timeout waiting for ${n}`))},o),d=this.handlers.get(n);this.handlers.set(n,(u,f)=>(clearTimeout(l),this.pendingRequests.delete(c),d?this.handlers.set(n,d):this.handlers.delete(n),a(u),{success:!0})),this.send(e,t).catch(u=>{clearTimeout(l),this.pendingRequests.delete(c),i(u)})})}getHandlerCount(){return this.handlers.size}hasHandler(e){return this.handlers.has(e)}};C(P,"instance",null);let ue=P;const O=class O extends Y{constructor(){super("DebuggerService");C(this,"sessions",new Map);C(this,"CDP_VERSION","1.3")}static getInstance(){return O.instance||(O.instance=new O),O.instance}async initialize(){chrome.debugger.onDetach.addListener((e,t)=>{e.tabId&&(this.sessions.delete(e.tabId),this.logger.info(`Debugger detached from tab ${e.tabId}: ${t}`))}),chrome.debugger.onEvent.addListener((e,t,n)=>{this.logger.debug(`CDP Event from tab ${e.tabId}: ${t}`,n)}),this.logger.debug("Debugger listeners registered")}async attach(e){await this.ensureInitialized();const t=this.sessions.get(e);if(t!=null&&t.attached){this.logger.debug(`Already attached to tab ${e}`);return}try{await chrome.debugger.attach({tabId:e},this.CDP_VERSION),this.sessions.set(e,{tabId:e,attached:!0,attachedAt:Date.now()}),this.logger.info(`Attached debugger to tab ${e}`)}catch(n){if(n instanceof Error&&n.message.includes("Another debugger is already attached")){this.sessions.set(e,{tabId:e,attached:!0,attachedAt:Date.now()}),this.logger.debug(`Debugger already attached externally to tab ${e}`);return}throw n}}async detach(e){await this.ensureInitialized();const t=this.sessions.get(e);if(!(t!=null&&t.attached)){this.logger.debug(`Not attached to tab ${e}`);return}return this.withErrorHandling(async()=>{await chrome.debugger.detach({tabId:e}),this.sessions.delete(e),this.logger.info(`Detached debugger from tab ${e}`)},`detach(${e})`)}isAttached(e){var t;return((t=this.sessions.get(e))==null?void 0:t.attached)??!1}async sendCommand(e,t,n){return await this.ensureInitialized(),await this.attach(e),this.withErrorHandling(async()=>(this.logger.debug(`CDP: ${t}`,n),await chrome.debugger.sendCommand({tabId:e},t,n)),`sendCommand(${t})`)}async navigate(e,t){await this.sendCommand(e,"Page.navigate",{url:t}),await this.waitForLoad(e)}async reload(e,t=!1){await this.sendCommand(e,"Page.reload",{ignoreCache:t}),await this.waitForLoad(e)}async goBack(e){const t=await this.sendCommand(e,"Page.getNavigationHistory");t.currentIndex>0&&await this.sendCommand(e,"Page.navigateToHistoryEntry",{entryId:t.currentIndex-1})}async goForward(e){const t=await this.sendCommand(e,"Page.getNavigationHistory");t.currentIndex<t.entries.length-1&&await this.sendCommand(e,"Page.navigateToHistoryEntry",{entryId:t.currentIndex+1})}async getDocument(e){return(await this.sendCommand(e,"DOM.getDocument",{depth:-1})).root}async querySelector(e,t){const n=await this.getDocument(e);return(await this.sendCommand(e,"DOM.querySelector",{nodeId:n.nodeId,selector:t})).nodeId}async getBoxModel(e,t){return(await this.sendCommand(e,"DOM.getBoxModel",{nodeId:t})).model}async getElementCenter(e,t){const n=await this.querySelector(e,t);if(!n)throw new Error(`Element not found: ${t}`);const a=(await this.getBoxModel(e,n)).content,i=(a[0]+a[2])/2,c=(a[1]+a[5])/2;return{x:i,y:c}}async click(e,t){const{x:n,y:o}=await this.getElementCenter(e,t);await this.sendCommand(e,"Input.dispatchMouseEvent",{type:"mousePressed",x:n,y:o,button:"left",clickCount:1}),await this.delay(50),await this.sendCommand(e,"Input.dispatchMouseEvent",{type:"mouseReleased",x:n,y:o,button:"left",clickCount:1}),this.logger.debug(`Clicked on ${t} at (${n}, ${o})`)}async type(e,t,n,o={}){const{clearFirst:a=!0,delay:i=50}=o;await this.click(e,t),await this.delay(100),a&&(await this.sendCommand(e,"Input.dispatchKeyEvent",{type:"keyDown",key:"a",code:"KeyA",modifiers:2}),await this.sendCommand(e,"Input.dispatchKeyEvent",{type:"keyUp",key:"a",code:"KeyA"}),await this.delay(50));for(const c of n)await this.sendCommand(e,"Input.dispatchKeyEvent",{type:"keyDown",text:c}),await this.sendCommand(e,"Input.dispatchKeyEvent",{type:"keyUp",text:c}),i>0&&await this.delay(i);this.logger.debug(`Typed "${n}" into ${t}`)}async scrollToElement(e,t,n="center"){await this.sendCommand(e,"Runtime.evaluate",{expression:`document.querySelector('${t}')?.scrollIntoView({ behavior: 'smooth', block: '${n}' })`}),await this.delay(500)}async scroll(e,t,n){await this.sendCommand(e,"Input.dispatchMouseEvent",{type:"mouseWheel",x:100,y:100,deltaX:t,deltaY:n})}async hover(e,t){const{x:n,y:o}=await this.getElementCenter(e,t);await this.sendCommand(e,"Input.dispatchMouseEvent",{type:"mouseMoved",x:n,y:o}),this.logger.debug(`Hovering over ${t} at (${n}, ${o})`)}async captureScreenshot(e,t={}){const{format:n="png",quality:o=80,fullPage:a=!1}=t;let i;if(a){const l=await this.sendCommand(e,"Page.getLayoutMetrics");i={x:0,y:0,width:l.contentSize.width,height:l.contentSize.height,scale:1}}const c=await this.sendCommand(e,"Page.captureScreenshot",{format:n,quality:n==="jpeg"?o:void 0,clip:i});return`data:image/${n};base64,${c.data}`}async waitForLoad(e,t=3e4){const n=Date.now();for(;Date.now()-n<t;){if((await this.sendCommand(e,"Runtime.evaluate",{expression:"document.readyState"})).result.value==="complete")return;await this.delay(100)}throw new Error("Page load timeout")}async evaluate(e,t){return(await this.sendCommand(e,"Runtime.evaluate",{expression:t,returnByValue:!0})).result.value}async evaluateInPage(e,t){var o;return(o=(await chrome.scripting.executeScript({target:{tabId:e},world:"MAIN",func:t}))[0])==null?void 0:o.result}async evaluateInPageWithArgs(e,t,n){var a;return(a=(await chrome.scripting.executeScript({target:{tabId:e},world:"MAIN",func:t,args:n}))[0])==null?void 0:a.result}getSessions(){return new Map(this.sessions)}async detachAll(){const e=Array.from(this.sessions.keys());await Promise.allSettled(e.map(t=>this.detach(t)))}delay(e){return new Promise(t=>setTimeout(t,e))}async dispose(){await this.detachAll(),await super.dispose()}};C(O,"instance",null);let ge=O;class ve{constructor(r){C(this,"logger");C(this,"config");this.config=r,this.logger=new K(`LLM:${r.provider}`)}buildHeaders(){return{"Content-Type":"application/json"}}handleApiError(r,e){const t=typeof e=="object"&&e!==null&&"error"in e?JSON.stringify(e.error):`HTTP ${r.status}`;throw this.logger.error("API error",{status:r.status,error:e}),new Error(`${this.name} API error: ${t}`)}async fetchWithRetry(r,e,t=3){let n=null;for(let o=1;o<=t;o++)try{return await fetch(r,e)}catch(a){n=a instanceof Error?a:new Error(String(a)),this.logger.warn(`Request failed (attempt ${o}/${t})`,n),o<t&&await new Promise(i=>setTimeout(i,Math.pow(2,o)*1e3))}throw n??new Error("Request failed after retries")}estimateTokens(r){return Math.ceil(r.length/4)}updateConfig(r){this.config={...this.config,...r}}getConfig(){const{apiKey:r,...e}=this.config;return e}sanitizeText(r){return r&&(r=r.replace(/data:image\/[a-zA-Z0-9.+-]+;base64,[A-Za-z0-9+/=]+/g,"[Image omitted]"),r.split(/\n{2,}/g).map(n=>{const o=n.trim();if(!o)return"";const a=o.split(/\n/),i=o.length>1e3&&a.length>15,c=a.filter(d=>d.length<50&&!d.includes(". ")).length/a.length;if(i&&c>.7){const d=o.match(/(?:summary|in summary|in short|key points|notable|highlights)[:\-\s]*([^\n]{20,200})/i);return d?`[Screenshot summarized]: ${d[1].trim().slice(0,200)}...`:"[Screenshot content omitted â€” summary available on request]"}return o.length>2e3?o.slice(0,1500)+`
...[truncated]`:o}).filter(Boolean).join(`

`))}}function X(s,r){return{role:s,content:r}}function bt(s){return X("system",s)}function wt(s){return X("user",s)}function vt(s){return X("assistant",s)}class ct extends ve{constructor(e){super(e);C(this,"baseUrl","https://generativelanguage.googleapis.com/v1beta")}get name(){return"Gemini"}validateConfig(){return!!(this.config.apiKey&&this.config.model)}async chat(e){var u,f,v;if(!this.validateConfig())throw new Error("Invalid Gemini configuration: missing API key or model");const t=this.config.model||"gemini-2.0-flash",n=`${this.baseUrl}/models/${t}:generateContent?key=${this.config.apiKey}`;console.log("[Gemini DEBUG] ============================"),console.log("[Gemini DEBUG] Base URL:",this.baseUrl),console.log("[Gemini DEBUG] Model from config:",this.config.model),console.log("[Gemini DEBUG] Model being used:",t),console.log("[Gemini DEBUG] API Key prefix:",((u=this.config.apiKey)==null?void 0:u.substring(0,8))+"..."),console.log("[Gemini DEBUG] Full URL (no key):",n.replace(/key=.*$/,"key=***")),console.log("[Gemini DEBUG] ============================");const o=this.buildRequestBody(e),a=6e4,i=new AbortController,c=setTimeout(()=>i.abort(),a);let l;e.signal?"any"in AbortSignal?l=AbortSignal.any([e.signal,i.signal]):(e.signal.addEventListener("abort",()=>i.abort()),l=i.signal):l=i.signal;const d={...o,contents:o.contents.map(h=>({role:h.role,parts:h.parts.map(m=>"inlineData"in m&&m.inlineData?{inlineData:{mime_type:m.inlineData.mime_type,data:`[${m.inlineData.data.length} bytes]`}}:m)}))};this.logger.debug("Gemini request",{model:this.config.model,messageCount:e.messages.length,requestBody:JSON.stringify(d,null,2)}),console.log("[Gemini] Request URL:",n),console.log("[Gemini] Request body:",JSON.stringify(d,null,2)),console.log("[Gemini] Tools:",(f=e.tools)==null?void 0:f.map(h=>h.function.name));try{const h=await this.fetchWithRetry(n,{method:"POST",headers:this.buildHeaders(),body:JSON.stringify(o),signal:l}),m=await h.clone().text();console.log("[Gemini DEBUG] Raw response status:",h.status),console.log("[Gemini DEBUG] Raw response text:",m.substring(0,2e3));let g;const y=h.headers.get("Content-Type");try{if(y&&y.includes("application/json"))g=JSON.parse(m);else throw this.logger.error("Received non-JSON response from Gemini",{status:h.status,statusText:h.statusText,contentType:y,text:m.slice(0,500)}),new Error(`Expected JSON response but received ${y||"unknown type"}. Status: ${h.status} ${h.statusText}. Response: ${m.slice(0,200)}...`)}catch(S){throw this.logger.error("Failed to parse Gemini response",S),S instanceof Error?S:new Error(String(S))}this.logger.debug("Gemini response",{status:h.status,ok:h.ok,data:JSON.stringify(g).substring(0,1e3)});const x=((v=g.error)==null?void 0:v.message)||g.message||g.detail||(typeof g.error=="string"?g.error:null);if(!h.ok||g.error||x){if(this.logger.error("Gemini API error - full response",{status:h.status,statusText:h.statusText,headers:Object.fromEntries(h.headers.entries()),error:g.error,errorMessage:x,fullResponse:JSON.stringify(g,null,2)}),this.logger.error("Failed request details",{requestBody:JSON.stringify(d,null,2)}),x)throw new Error(`API Error: ${x}`);this.handleApiError(h,g)}return this.parseResponse(g)}catch(h){throw h instanceof Error&&h.name==="AbortError"?new Error(`Request timed out after ${a/1e3} seconds. The server may be slow or unresponsive.`):h}finally{clearTimeout(c)}}buildRequestBody(e){const n={contents:this.formatMessages(e.messages),generationConfig:{temperature:e.temperature??this.config.temperature??0,maxOutputTokens:e.maxTokens??this.config.maxTokens??8192}};return e.tools&&e.tools.length>0&&(n.tools=this.formatTools(e.tools),n.tool_config={function_calling_config:{mode:"AUTO"}}),n}formatMessages(e){var a,i,c;const t=[];let n="";const o="You are a helpful AI assistant.";for(const l of e){if(l.role==="system"){n+=typeof l.content=="string"?l.content:l.content.map(f=>f.text??"").join(`
`);continue}if(l.role==="tool"&&l.toolCallId){const f=l.name||l.toolCallId,v=[];let h;if(Array.isArray(l.content)){h=l.content.filter(g=>g.type==="text").map(g=>g.text).join(`
`)||JSON.stringify(l.content);for(const g of l.content)if(g.type==="image_url"&&((a=g.image_url)!=null&&a.url)){const y=g.image_url.url;if(y.startsWith("data:")&&y.includes(",")){const[x,S]=y.split(","),k=((i=x.split(":")[1])==null?void 0:i.split(";")[0])??"image/png";S&&k&&v.push({inlineData:{mime_type:k,data:S.trim()}})}}}else h=typeof l.content=="string"?l.content:JSON.stringify(l.content);v.unshift({functionResponse:{name:f,response:{result:h}}}),t.push({role:"user",parts:v});continue}const d=l.role==="assistant"?"model":"user",u=this.formatParts(l.content,l.toolCalls);if(u.length===0){this.logger.warn("Skipping message with empty parts",{role:l.role,contentType:typeof l.content,contentLength:typeof l.content=="string"?l.content.length:(c=l.content)==null?void 0:c.length});continue}if(d==="user"&&t.length===0){const f=n||o;u.unshift({text:`${f}

`}),n=""}t.push({role:d,parts:u})}if(t.length===0)throw this.logger.error("No valid contents generated from messages",{messageCount:e.length,messages:e.map(l=>({role:l.role,contentType:typeof l.content}))}),new Error("No valid message contents could be generated");for(let l=0;l<t.length;l++){if(!t[l].parts||t[l].parts.length===0)throw this.logger.error(`Content at index ${l} has empty parts`,{content:t[l]}),new Error(`Invalid content at index ${l}: empty parts array`);for(let d=0;d<t[l].parts.length;d++){const u=t[l].parts[d],f="text"in u&&u.text,v="inlineData"in u&&u.inlineData&&u.inlineData.data&&u.inlineData.mime_type,h="functionCall"in u&&u.functionCall,m="functionResponse"in u&&u.functionResponse;!f&&!v&&!h&&!m&&(this.logger.error(`Invalid part at contents[${l}].parts[${d}]`,{part:JSON.stringify(u),hasText:f,hasInlineData:v,hasFunctionCall:h,hasFunctionResponse:m}),t[l].parts[d]={text:"[Invalid content removed]"},this.logger.warn(`Replaced invalid part at contents[${l}].parts[${d}] with placeholder`))}}return t}formatParts(e,t){var o;const n=[];if(typeof e=="string")e.trim()&&n.push({text:e});else if(Array.isArray(e)){for(const a of e)if(a.type==="text"&&a.text&&a.text.trim())n.push({text:a.text});else if((a.type==="image_url"||a.type==="image")&&a.image_url){const i=a.image_url.url;if(i&&i.startsWith("data:")&&i.includes(",")){const[c,l]=i.split(",");if(l&&l.trim()&&c){const d=((o=c==null?void 0:c.split(":")[1])==null?void 0:o.split(";")[0])??"image/png";d?n.push({inlineData:{mime_type:d,data:l.trim()}}):this.logger.warn("Skipping image with invalid mime type",{header:c})}else this.logger.warn("Skipping image with empty or invalid data URL",{hasHeader:!!c,hasData:!!l,dataTrimmed:l==null?void 0:l.trim().substring(0,50)})}else this.logger.warn("Skipping invalid image URL",{url:i==null?void 0:i.substring(0,100)})}else a.inline_data&&(a.inline_data.data&&typeof a.inline_data.data=="string"&&a.inline_data.data.trim()&&a.inline_data.mime_type?n.push({inlineData:{mime_type:a.inline_data.mime_type,data:a.inline_data.data.trim()}}):this.logger.warn("Skipping invalid inline_data",{hasData:!!a.inline_data.data,hasMimeType:!!a.inline_data.mime_type}));n.length===0&&e.length>0&&(this.logger.warn("All parts filtered out, adding placeholder text"),n.push({text:"[Content filtered - no valid data]"}))}if(t)for(const a of t){const i={functionCall:{name:a.function.name,args:JSON.parse(a.function.arguments)}};a.thoughtSignature&&(i.thought_signature=a.thoughtSignature),n.push(i)}return n}formatTools(e){return{functionDeclarations:e.map(t=>({name:t.function.name,description:t.function.description,parameters:t.function.parameters}))}}parseResponse(e){var l;const t=(l=e.candidates)==null?void 0:l[0];if(!t)throw this.logger.error("No candidates in Gemini response",{data:e}),new Error("No response from Gemini - the server returned an empty response");if(!t.content||!t.content.parts||t.content.parts.length===0)return this.logger.error("Empty content in Gemini response",{candidate:t}),{message:{role:"assistant",content:"I apologize, but I received an empty response from the server. Please try again."},finishReason:"stop"};const n=t.content.parts;let o="";const a=[];for(const d of n)d.text&&(o+=d.text),d.functionCall&&a.push({id:`call_${Date.now()}_${a.length}`,type:"function",function:{name:d.functionCall.name,arguments:JSON.stringify(d.functionCall.args)},thoughtSignature:d.thought_signature});o=this.sanitizeText(o),!o&&a.length===0&&(this.logger.warn("Both text and tool calls are empty in response"),o="I encountered an issue processing your request. Please try again.");const i=a.length>0,c=this.mapFinishReason(t.finishReason,i);return{message:{role:"assistant",content:o,toolCalls:i?a:void 0},finishReason:c,usage:e.usageMetadata?{promptTokens:e.usageMetadata.promptTokenCount,completionTokens:e.usageMetadata.candidatesTokenCount,totalTokens:e.usageMetadata.totalTokenCount}:void 0}}mapFinishReason(e,t){if(t)return"tool_calls";switch(e){case"STOP":return"stop";case"MAX_TOKENS":return"length";case"SAFETY":return"content_filter";default:return"stop"}}}class xe extends ve{constructor(r){super(r)}get name(){return"OpenAI"}validateConfig(){return!!(this.config.apiKey&&this.config.model)}async chat(r){if(!this.validateConfig())throw new Error("Invalid OpenAI configuration: missing API key or model");const t=`${this.config.baseUrl||"https://api.openai.com/v1"}/chat/completions`,n=this.buildRequestBody(r);this.logger.debug("OpenAI request",{model:this.config.model,messageCount:r.messages.length});const o=await this.fetchWithRetry(t,{method:"POST",headers:this.buildHeaders(),body:JSON.stringify(n),signal:r.signal}),a=o.headers.get("Content-Type");let i;try{if(a&&a.includes("application/json"))i=await o.json();else{const c=await o.text();throw this.logger.error("Received non-JSON response",{contentType:a,text:c.slice(0,500)}),new Error(`Expected JSON response but received ${a||"unknown type"}. This usually happens when the API URL is incorrect (e.g., pointing to a landing page or 404).`)}}catch(c){throw c instanceof Error&&c.message.includes("Expected JSON")?c:(this.logger.error("Failed to parse response as JSON",c),new Error(`Failed to parse response as JSON: ${c instanceof Error?c.message:String(c)}`))}return(!o.ok||i.error)&&this.handleApiError(o,i),this.parseResponse(i)}buildHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`}}buildRequestBody(r){const e={model:this.config.model,messages:this.formatMessages(r.messages),temperature:r.temperature??this.config.temperature??0,max_tokens:r.maxTokens??this.config.maxTokens??4096,stream:!1};return r.tools&&r.tools.length>0&&(e.tools=this.formatTools(r.tools)),e}formatMessages(r){return r.map(e=>{const t={role:e.role,content:this.formatContent(e.content)};return e.toolCalls&&(t.tool_calls=e.toolCalls),e.toolCallId&&(t.tool_call_id=e.toolCallId),e.name&&(t.name=e.name),t})}formatContent(r){return typeof r=="string"?r:r.map(e=>e.type==="text"?{type:"text",text:e.text}:e.type==="image_url"||e.type==="image"?{type:"image_url",image_url:e.image_url??{url:""}}:e.inline_data?{type:"image_url",image_url:{url:`data:${e.inline_data.mime_type};base64,${e.inline_data.data}`}}:{type:"text",text:""})}formatTools(r){return r}parseResponse(r){const e=r.choices[0];if(!e)throw new Error("No response from OpenAI");const t=e.message,n=!!(t.tool_calls&&t.tool_calls.length>0);return{message:{role:"assistant",content:this.sanitizeText(t.content??""),toolCalls:t.tool_calls},finishReason:this.mapFinishReason(e.finish_reason,n),usage:r.usage?{promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens,totalTokens:r.usage.total_tokens}:void 0}}mapFinishReason(r,e){if(e)return"tool_calls";switch(r){case"stop":return"stop";case"length":return"length";case"content_filter":return"content_filter";case"tool_calls":return"tool_calls";default:return"stop"}}}class Ce extends xe{constructor(r){const e={...r,baseUrl:r.baseUrl||"http://localhost:11434/v1",apiKey:r.apiKey||"ollama"};super(e)}get name(){return"Ollama"}validateConfig(){return!!(this.config.model&&this.config.baseUrl)}async chat(r){var e;try{if(!(await fetch(`${((e=this.config.baseUrl)==null?void 0:e.replace("/v1",""))??""}/api/tags`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok)throw new Error("Ollama is not responding")}catch(t){this.logger.error("Ollama health check failed",t);const n=this.config.baseUrl||"";throw n.includes("localhost")||n.includes("127.0.0.1")?new Error("Cannot connect to Ollama. Make sure Ollama is running locally on port 11434."):new Error(`Cannot connect to Ollama at ${n}. Please check the URL and your network connection.`)}return super.chat(r)}buildHeaders(){return{"Content-Type":"application/json"}}async listModels(){var r;try{const e=((r=this.config.baseUrl)==null?void 0:r.replace("/v1",""))??"http://localhost:11434",t=await fetch(`${e}/api/tags`);if(!t.ok)throw new Error(`Failed to list models: ${t.statusText}`);const n=t.headers.get("Content-Type");let o;try{if(n&&n.includes("application/json"))o=await t.json();else{const a=await t.text();throw this.logger.error("Received non-JSON response from Ollama",{contentType:n,text:a.slice(0,500)}),new Error(`Expected JSON response but received ${n||"unknown type"}`)}}catch(a){return this.logger.error("Failed to parse Ollama models response",a),[]}return o.models.map(a=>a.name)}catch(e){return this.logger.error("Failed to list Ollama models",e),[]}}async isModelAvailable(r){return(await this.listModels()).some(t=>t===r||t.startsWith(`${r}:`))}async pullModel(r){var o,a;const e=((o=this.config.baseUrl)==null?void 0:o.replace("/v1",""))??"http://localhost:11434";this.logger.info(`Pulling model: ${r}`);const t=await fetch(`${e}/api/pull`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r})});if(!t.ok)throw new Error(`Failed to pull model: ${t.statusText}`);const n=(a=t.body)==null?void 0:a.getReader();if(n)for(;;){const{done:i,value:c}=await n.read();if(i)break;const d=new TextDecoder().decode(c).split(`
`).filter(Boolean);for(const u of d)try{const f=JSON.parse(u);f.status&&this.logger.debug(`Pull progress: ${f.status}`)}catch{}}this.logger.info(`Model ${r} pulled successfully`)}}class dt extends Ce{constructor(r){super({...r,baseUrl:r.baseUrl||"https://ollama.com"})}get name(){return"Ollama Cloud"}buildHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`}}async chat(r){let e=this.config.baseUrl||"https://ollama.com";e.endsWith("/")&&(e=e.slice(0,-1)),e.endsWith("/api/chat")||(e=`${e}/api/chat`),this.logger.debug("Ollama Cloud Request",{url:e,model:this.config.model});try{const t=await fetch(e,{method:"POST",headers:this.buildHeaders(),body:JSON.stringify({model:this.config.model,messages:r.messages,stream:!1,options:{temperature:r.temperature}})});if(!t.ok){const o=await t.text();throw new Error(`Ollama Cloud Error (${t.status}): ${o}`)}const n=await t.json();if(!n.message)throw new Error('Invalid response from Ollama Cloud: missing "message" field');return{message:{role:n.message.role||"assistant",content:n.message.content||""},finishReason:"stop"}}catch(t){throw this.logger.error("Ollama Cloud chat failed",t),t}}}const B=new K("LLMProviderFactory"),he=new Map;function ut(s){const r=`${s.provider}:${s.model}:${s.baseUrl??""}`,e=he.get(r);if(e)return e.updateConfig(s),e;let t;switch(s.provider){case E.GEMINI:t=new ct(s);break;case E.OPENAI:t=new xe(s);break;case E.OLLAMA:t=new Ce(s);break;case E.OLLAMA_CLOUD:t=new dt(s);break;default:throw B.error(`Unknown provider: ${s.provider}`),new Error(`Unknown LLM provider: ${s.provider}`)}return he.set(r,t),B.info(`Created ${t.name} provider`,{model:s.model}),t}function gt(s){const r=[];switch(s.provider||r.push("Provider is required"),s.model||r.push("Model is required"),s.provider){case E.GEMINI:s.apiKey||r.push("API key is required for Gemini");break;case E.OPENAI:s.apiKey||r.push("API key is required for OpenAI");break;case E.OLLAMA:s.baseUrl||r.push("Base URL is required for Ollama");break;case E.OLLAMA_CLOUD:s.baseUrl||r.push("Base URL is required for Ollama Cloud");break}return{valid:r.length===0,errors:r}}async function xt(s){const r=gt(s);if(!r.valid)return{success:!1,error:r.errors.join(", ")};const e=Date.now();try{const t=ut(s),n=await t.chat({messages:[{role:"user",content:"Hello"}]}),o=Date.now()-e;return n.message.content?(B.info(`Provider test successful: ${t.name}`,{responseTime:o}),{success:!0,responseTime:o}):{success:!1,error:"Empty response"}}catch(t){return B.error("Provider test failed",t),{success:!1,error:t instanceof Error?t.message:String(t)}}}export{Y as B,ce as D,ot as G,E as L,ue as M,yt as P,de as S,ke as a,lt as b,mt as c,ge as d,ut as e,bt as f,wt as g,vt as h,ft as i,xt as t};

(function(){(function(){(function(){const $="https://www.amazon.[DOMAIN]/s?k=[QUERY]",r={result_item:'div[data-component-type="s-search-result"]',title:"a > h2 > span",price:"span.a-price-whole",rating:'span[aria-label*="out of 5 stars"], i[data-hook="average-star-rating"] span.a-icon-alt, .a-icon-star-small span.a-icon-alt',reviews:'span[aria-label*="ratings"], a[href*="#customerReviews"] span',link:"a.a-link-normal.s-no-outline, h2 a"},O=["#add-to-cart-button","#add-to-cart-button-ubb","#add-to-cart-button .a-button-input"],D=['button[name="submit.addToCart"]','button[data-action="add-to-cart"]','input[name="submit.add-to-cart"]','.a-button-input[aria-label*="Add to Cart"]','form[action*="add-to-cart"] input[type="submit"]'],I="select[id*='variation'], select[id^='native_dropdown']",p={cartButton:"#nav-cart",proceedToCheckout:"#sc-buy-box-ptc-button > span > input"},f={addToCartButton:"#add-to-cart-button"};function L(o){return`[data-uuid="${o}"] > div > div > span > div > div > div.a-section.a-spacing-small.puis-padding-left-small.puis-padding-right-small > div.a-section.a-spacing-none.a-spacing-top-small.s-title-instructions-style > a`}function R(o){if(!o)return null;const e=o.replace(/[^0-9.,-]/g,"").replace(/,/g,""),t=parseFloat(e);return Number.isFinite(t)?t:null}function N(o){if(!o)return null;const e=o.match(/([\d.]+)\s*(?:out of 5)?/i);if(e){const t=parseFloat(e[1]);if(Number.isFinite(t)&&t>=0&&t<=5)return t}return null}function U(o){if(!o)return null;const e=o.replace(/[^0-9]/g,"");if(e.length===0)return null;const t=parseInt(e,10);return Number.isFinite(t)&&t>=0?t:null}function x(){if(console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ” [AMAZON] PRODUCT DETECTION STARTED"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(`ğŸ“ Current URL: ${window.location.href}`),window.location.pathname.includes("/dp/")||window.location.pathname.includes("/gp/product/"))return console.log("â„¹ï¸  Detected PRODUCT DETAIL PAGE - switching to single product detection"),_();if(window.location.pathname==="/"||window.location.pathname==="")return console.log("â„¹ï¸  Detected HOMEPAGE - no search results to extract"),console.log("ğŸ’¡ TIP: Try searching for a product first, then use the assistant"),[];console.log(`ğŸ“ Using selector: "${r.result_item}"`);const o=document.querySelectorAll(r.result_item);if(console.log(`âœ“ Found ${o.length} product containers
`),o.length===0){console.log("âš ï¸  No results with primary selector, trying alternatives...");const e=['div[data-asin]:not([data-asin=""])',".s-result-item[data-asin]","div.s-result-item"];for(const t of e){const n=document.querySelectorAll(t);if(console.log(`  ğŸ“ Trying "${t}": found ${n.length}`),n.length>0)return console.log(`  âœ“ Using alternative selector: "${t}"`),P(n)}return console.log("âŒ No products found with any selector"),console.log("ğŸ’¡ TIP: Make sure you're on a search results page"),[]}return P(o)}function _(){const o=document.querySelector("#productTitle, #title"),e=document.querySelector(".a-price .a-offscreen, #priceblock_ourprice, #priceblock_dealprice"),t=document.querySelector("#acrPopover .a-icon-alt, .a-icon-star .a-icon-alt");if(!o)return console.log("âŒ Could not find product title on product page"),[];const n=(o.textContent||"").trim(),c=R(e?(e.textContent||"").trim():void 0),l=N(t?(t.textContent||"").trim():void 0);return console.log(`âœ“ Found single product: ${n}`),console.log(`  ğŸ’° Price: ${c}`),console.log(`  â­ Rating: ${l}`),[{"data-uuid":"single-product",title:n,price:c,rating:l,reviews:null,link:window.location.href,selector:"#productTitle",priceNumber:c,isDetailPage:!0}]}function P(o){const e=[],t=Array.from(o).slice(0,20);return console.log(`ğŸ“Š Processing first ${t.length} products...
`),t.forEach((n,c)=>{if(console.group(`ğŸ›ï¸  Product #${c+1}`),!q(n)){console.log("âŒ SKIPPED - Not visible"),console.groupEnd();return}if((n.textContent||"").toLowerCase().includes("sponsored")){console.log("âŒ SKIPPED - Sponsored product"),console.groupEnd();return}const s=n,T=s.getAttribute("data-uuid")||s.getAttribute("data-asin")||`product-${c}`;console.log(`ğŸ”– UUID: ${T}`),console.log(`ğŸ“ Title selector: "${r.title}"`);const h=s.querySelector(r.title),i=h?(h.textContent||"").trim():null;console.log(`ğŸ“ Title found: "${i}"`),console.log(`ğŸ“ Title length: ${(i==null?void 0:i.length)||0} characters`),console.log(`ğŸ“ Price selector: "${r.price}"`);const m=s.querySelector(r.price),C=m?(m.textContent||"").trim():null;console.log(`ğŸ’µ Price text: "${C}"`);const d=R(C||void 0);console.log(`ğŸ’° Price parsed: ${d}`),console.log(`ğŸ“ Rating selector: "${r.rating}"`);const E=s.querySelector(r.rating),u=E?(E.textContent||"").trim():null;if(console.log(`â­ Rating text: "${u}"`),u&&(u.toLowerCase().includes("previous")||u.toLowerCase().includes("next")||u.toLowerCase().includes("page"))){console.log("âŒ SKIPPED - Invalid rating text detected (navigation element)"),console.groupEnd();return}const A=N(u||void 0);console.log(`â­ Rating parsed: ${A}`),console.log(`ğŸ“ Reviews selector: "${r.reviews}"`);const b=s.querySelector(r.reviews),S=b?(b.textContent||"").trim():null;console.log(`ğŸ’¬ Reviews text: "${S}"`);const w=U(S||void 0);console.log(`ğŸ’¬ Reviews parsed: ${w}`),console.log(`ğŸ“ Link selector: "${r.link}"`);const v=s.querySelector(r.link),k=v?v.href:null;if(console.log(`ğŸ”— Link: ${k}`),!i){console.log("âŒ SKIPPED - No title found"),console.groupEnd();return}if(d===null){console.log("âŒ SKIPPED - No price found"),console.groupEnd();return}const y={"data-uuid":T,title:i,price:d,rating:A,reviews:w,link:k,selector:B(s)||void 0,priceNumber:d};e.push(y),console.log("âœ… ADDED to results"),console.groupEnd(),console.log("")}),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“¦ EXTRACTION COMPLETE"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(`ğŸ“Š Total containers found: ${o.length}`),console.log(`âœ“ Valid products extracted: ${e.length}`),console.log(`
ğŸ“‹ PRODUCTS BEING SENT TO LLM (FULL TITLES - NOT TRUNCATED):
`),e.forEach((n,c)=>{console.log(`
ğŸ›ï¸  PRODUCT ${c+1}:`),console.log(`   ğŸ“ Title:   ${n.title}`),console.log(`   ğŸ’° Price:   $${n.price}`),console.log(`   â­ Rating:  ${n.rating||"N/A"}`),console.log(`   ğŸ’¬ Reviews: ${n.reviews||"N/A"}`),console.log(`   ğŸ”— Link:    ${n.link}`),console.log(`   ğŸ·ï¸  UUID:    ${n["data-uuid"]}`)}),console.log(`
ğŸ“Š SUMMARY TABLE:`),console.table(e.map(n=>({"Title (Full)":n.title,Price:`$${n.price}`,Rating:n.rating||"N/A",Reviews:n.reviews||"N/A"}))),console.log(`
ğŸ“„ FULL JSON DATA (for LLM):`),console.log(JSON.stringify(e,null,2)),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`),e}async function M(o){console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ›’ [AMAZON] EXECUTING: ADD TO CART"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“‹ Arguments received:"),console.log(JSON.stringify(o,null,2)),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);try{if(g())return console.log("âš ï¸  CAPTCHA detected - aborting action"),{success:!1,error:"CAPTCHA detected - pausing actions",data:{captcha:!0}};if(o.addToCartSelector){console.log(`ğŸ” Trying pre-detected ATC selector: ${o.addToCartSelector}`);const c=document.querySelector(o.addToCartSelector);if(c&&!c.disabled)return console.log("âœ“ Button found and enabled - clicking"),c.click(),await a(400+Math.random()*600),console.log(`âœ… Success: Clicked pre-detected SRP button
`),{success:!0,data:{clicked:"srp_predetected"}};console.log("âŒ Button not found or disabled")}if(o.selector){console.log(`ğŸ” Trying product card selector: ${o.selector}`);const c=document.querySelector(o.selector);if(c){console.log("âœ“ Product card found");for(const l of D){console.log(`  ğŸ” Trying ATC selector: ${l}`);const s=c.querySelector(l);if(s&&!s.disabled)return console.log("  âœ“ Button found and enabled - clicking"),s.click(),await a(400+Math.random()*600),console.log(`âœ… Success: Clicked SRP card button
`),{success:!0,data:{clicked:"srp_card"}}}console.log("âŒ No enabled ATC button found in card")}else console.log("âŒ Product card not found")}if(o.link)return console.log(`ğŸ”— Navigating to product page: ${o.link}`),window.location.href=o.link,console.log(`âœ… Success: Navigation initiated
`),{success:!0,data:{navigatedToPDP:!0,url:o.link}};if(o.productId){console.log(`ğŸ” Trying to find product by ID: ${o.productId}`);const c=document.querySelector(`[data-asin='${o.productId}'], a[href*='/${o.productId}']`);if(c){const l=c.closest("a");if(l!=null&&l.href)return console.log(`âœ“ Product link found: ${l.href}`),window.location.href=l.href,console.log(`âœ… Success: Navigation initiated
`),{success:!0,data:{navigatedToPDP:!0,url:l.href}}}console.log("âŒ Product link not found")}console.log("ğŸ” Checking for variant selectors");const e=document.querySelector(I);e&&e.options.length>1&&(console.log("âœ“ Variant selector found - selecting first option"),e.selectedIndex=1,e.dispatchEvent(new Event("change",{bubbles:!0})),await a(500+Math.random()*600)),console.log("ğŸ” Trying standard ATC selectors");for(const c of O){console.log(`  ğŸ” Trying: ${c}`);const l=document.querySelector(c);if(l&&!l.disabled)return console.log("  âœ“ Button found and enabled - clicking"),l.click(),await a(500+Math.random()*700),console.log(`âœ… Success: Clicked button with selector ${c}
`),{success:!0,data:{clicked:c}}}console.log("âŒ No enabled buttons found with standard selectors"),console.log("ğŸ” Trying text-based button search");const n=Array.from(document.querySelectorAll('button, input[type="submit"], input[type="button"], a.a-button-text')).find(c=>{const l=(c.textContent||c.value||"").toLowerCase().trim();return(l==="add to cart"||l==="add to basket")&&!c.disabled});return n?(console.log(`âœ“ Found button with text: "${n.textContent}"`),n.click(),await a(500+Math.random()*700),console.log(`âœ… Success: Clicked text-matched button
`),{success:!0,data:{clicked:"text_match",text:n.textContent}}):(console.log(`âŒ FAILED: No add-to-cart button found
`),{success:!1,error:"Add to cart not available or blocked - tried selectors and text match"})}catch(e){return console.error("âŒ ERROR:",e),{success:!1,error:String(e)}}}function g(){return window.location.href.toLowerCase().includes("captcha")||/verify/i.test(document.body.textContent||"")?!0:document.querySelectorAll('form[action*="captcha"], div[class*="captcha"], iframe[src*="captcha"], iframe[src*="recaptcha"]').length>0}function q(o){try{const e=o.getBoundingClientRect();return e.width>0&&e.height>0}catch{return!1}}function B(o){if(!(o instanceof Element))return null;if(o.id)return`#${o.id}`;const e=[];let t=o;for(;t&&t.nodeType===Node.ELEMENT_NODE&&t!==document.documentElement;){let n=t.nodeName.toLowerCase();if(t.className){const c=t.className.split(" ")[0];c&&(n+=`.${c}`)}e.unshift(n),t=t.parentElement}return e.length?e.join(" > "):null}function a(o){return new Promise(e=>setTimeout(e,o))}async function F(o){if(console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“‹ [AMAZON] EXECUTING: NAVIGATE TO PRODUCT SPECS"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“‹ Arguments received:"),console.log(JSON.stringify(o,null,2)),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`),!o.productUuid)return console.log(`âŒ FAILED: No product UUID provided
`),{success:!1,error:"No product UUID provided"};try{const e=L(o.productUuid);console.log(`ğŸ” Built specs selector: ${e}`);const t=document.querySelector(e);return t?(console.log("âœ“ Product specs link found - clicking"),t.click(),await a(500+Math.random()*500),console.log(`âœ… Success: Navigated to product specs
`),{success:!0,data:{navigatedToSpecs:!0,uuid:o.productUuid}}):(console.log(`âŒ FAILED: Product specs link not found
`),{success:!1,error:"Product specs link not found"})}catch(e){return console.error("âŒ ERROR:",e),{success:!1,error:String(e)}}}async function G(o){console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ›’ [AMAZON] EXECUTING: ADD TO CART FROM PRODUCT PAGE"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“‹ Arguments received:"),console.log(JSON.stringify(o,null,2)),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);try{if(g())return console.log("âš ï¸  CAPTCHA detected - aborting action"),{success:!1,error:"CAPTCHA detected - pausing actions",data:{captcha:!0}};console.log(`ğŸ” Looking for add-to-cart button: ${f.addToCartButton}`);const e=document.querySelector(f.addToCartButton);return e&&!e.disabled?(console.log("âœ“ Button found and enabled - clicking"),e.click(),await a(500+Math.random()*700),console.log(`âœ… Success: Product added to cart
`),{success:!0,data:{clicked:"product_page_atc"}}):(console.log(`âŒ FAILED: Add to cart button not found or disabled
`),{success:!1,error:"Add to cart button not available"})}catch(e){return console.error("âŒ ERROR:",e),{success:!1,error:String(e)}}}function H(){console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ›’ [AMAZON] EXECUTING: NAVIGATE TO CART"),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);try{const e=window.location.hostname.match(/amazon\.(.+)$/),t=e?e[1]:"com",n=`https://www.amazon.${t}/gp/cart/view.html?ref_=nav_cart`;return console.log(`âœ“ Detected domain: ${t}`),console.log(`âœ“ Navigating to: ${n}`),window.location.href=n,console.log(`âœ… Success: Navigated to cart
`),{success:!0,data:{navigatedToCart:!0,url:n}}}catch(o){return console.error("âŒ ERROR:",o),{success:!1,error:String(o)}}}function V(o){return console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ”— [AMAZON] EXECUTING: NAVIGATE TO PRODUCT"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“‹ Arguments received:"),console.log(JSON.stringify(o,null,2)),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`),o.link?(console.log(`ğŸ”— Navigating to: ${o.link}`),window.location.href=o.link,console.log(`âœ… Success: Navigation initiated
`),{success:!0,data:{navigatedToPDP:!0,url:o.link}}):(console.log(`âŒ FAILED: No link URL provided
`),{success:!1,error:"No link URL provided"})}async function X(){console.log(`
`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ’³ [AMAZON] EXECUTING: PROCEED TO CHECKOUT"),console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);try{const o=window.location.href.toLowerCase();if(!o.includes("/gp/cart/")&&!o.includes("/cart/"))return console.log("âŒ FAILED: Not on cart page"),console.log(`Current URL: ${o}
`),{success:!1,error:"Not on cart page. Please navigate to cart first."};if(g())return console.log("âš ï¸  CAPTCHA detected - aborting action"),{success:!1,error:"CAPTCHA detected - pausing actions",data:{captcha:!0}};console.log(`ğŸ” Looking for proceed to checkout button: ${p.proceedToCheckout}`);const e=document.querySelector(p.proceedToCheckout);if(e&&!e.disabled)return console.log("âœ“ Button found and enabled - clicking"),e.click(),await a(500+Math.random()*700),console.log(`âœ… Success: Proceeding to checkout
`),{success:!0,data:{clicked:"proceed_to_checkout"}};const t=['input[name="proceedToRetailCheckout"]','input[name="proceedToCheckout"]','button[name="proceedToCheckout"]',"#sc-buy-box-ptc-button input"];for(const n of t){console.log(`  ğŸ” Trying alternative selector: ${n}`);const c=document.querySelector(n);if(c&&!c.disabled)return console.log("  âœ“ Button found and enabled - clicking"),c.click(),await a(500+Math.random()*700),console.log(`âœ… Success: Proceeding to checkout
`),{success:!0,data:{clicked:n}}}return console.log(`âŒ FAILED: Proceed to checkout button not found or disabled
`),{success:!1,error:"Proceed to checkout button not available"}}catch(o){return console.error("âŒ ERROR:",o),{success:!1,error:String(o)}}}window.__siteIntegration=window.__siteIntegration||{};window.__siteIntegration.amazon={detectProductCards:x,addToCart:M,addToCartFromProductPage:G,navigateToProduct:V,navigateToProductSpecs:F,navigateToCart:H,proceedToCheckout:X,detectCaptcha:g,SEARCH_TEMPLATE:$,SELECTORS:r,CART_SELECTORS:p,PRODUCT_PAGE_SELECTORS:f};window.__siteIntegrationReady=!0;console.debug("Amazon site integration injected and ready");
})()
})()
})()
